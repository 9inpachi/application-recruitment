<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>RecruitmentApp</web>
  <name>RecruitmentAppSheet</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>RecruitmentAppClass</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1367311699000</creationDate>
  <date>1370518816000</date>
  <contentUpdateDate>1370504417000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <template/>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <object>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <name>RecruitmentApp.RecruitmentAppSheet</name>
    <number>1</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>db44c17a-84a9-4259-9eff-dc48d731534d</guid>
    <property>
      <cache>default</cache>
    </property>
    <property>
      <code>(function(){
	document.observe('dom:loaded', function() {
		var jobPosting = $('RecruitmentApp.RecruitmentAppClass_0_jobPosting');
		if(jobPosting) {
			Event.observe(jobPosting, "focus", function(){
				new XWiki.widgets.Suggest(this, {
					script: "$xwiki.getURL('JobArea.AutoSuggest', 'get', 'spacename=JobArea&amp;outputSyntax=plain&amp;xpage=plain')&amp;",
					varname: "input",
					seps: " ,|",
					offsety: 13
				});
			});
		}
	});
})();</code>
    </property>
    <property>
      <name>autosuggest for jobs</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <name>RecruitmentApp.RecruitmentAppSheet</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>4aec9fdf-7202-41b3-ba73-f0a969991e3c</guid>
    <property>
      <cache>default</cache>
    </property>
    <property>
      <code>.evaluation {
   border: 1px solid #444;
   margin-bottom: 10px;
   margin-left: 30px;
}

.yes {
   border: 2px solid green;
}

.no {
   border: 2px solid red;
}

.evaluation h3 {
  padding: 10px 0 0 15px;
  margin: 0;
}

.hiremention {
  float: right;
  margin-right: 10px;
  padding: 5px;
}

.hiremention .yes {
   border: 2px solid green;
   color: green;
   text-transform: uppercase;
   padding: 5px;
   font-weight: bold;
}

.hiremention .no {
   border: 2px solid red;
   color: red;
   text-transform: uppercase;
   padding: 5px;
   font-weight: bold;
}

.new-evaluation {
    border: 1px solid #cccccc;
    margin-top: 20px;
    padding: 10px;
    margin-left: 30px;
}

.new-evaluation textarea {
    vertical-align: bottom;
    margin-left: 5px;
}

.new-evaluation input {
    margin-left: 20px;
    width: 40px;
}

.new-evaluation select {
    margin-left: 25px;
}

.new-evaluation .row {
    margin-bottom: 5px;
}

.new-evaluation input[type=submit] {
    width: auto;
    margin-left: 0;
}

.new-evaluation strong {
    vertical-align: top;
}

iframe {
  margin-left: 30px;
}

ul {
 list-style: none;
}</code>
    </property>
    <property>
      <name>Recruitment App Stylesheet</name>
    </property>
    <property>
      <parse/>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <content>{{velocity output="false"}}
$xwiki.jsx.use("RecruitmentApp.RecruitmentAppSheet")
$xwiki.ssx.use("RecruitmentApp.RecruitmentAppSheet")

#set($fullName = $doc.getDisplayTitle())
#if("$!fullName" != "")
  #set($lastIndexOfSpace = $fullName.lastIndexOf(" "))
  #if($lastIndexOfSpace != -1)
      $doc.set('first_name', $fullName.substring(0, $lastIndexOfSpace))
      $doc.set('last_name', $fullName.substring($mathtool.add($lastIndexOfSpace, 1)))
  #end
#end
#set ($discard = $doc.use('RecruitmentApp.RecruitmentAppClass'))
#set ($discard = $services.localization.use('document', 'RecruitmentApp.RecruitmentAppTranslations'))
{{/velocity}}
{{velocity}}{{html wiki="true" clean="false"}}
    {{tabs idsToLabels='personalInfo=Personal Information, candidateApp=Candidate Application, evaluations=Evaluations' /}}
    (%id='personalInfo'%)
    (((
    * **$doc.displayPrettyName('first_name'):** $doc.display('first_name')
    * **$doc.displayPrettyName('last_name'):** $doc.display('last_name')
    * **$doc.displayPrettyName('jobPosting'):** #if($context.action == "edit") $doc.display('jobPosting') #else #set($jobPosting = $doc.display('jobPosting')) #if("$!jobPosting" != "") #set($joburl = "JobArea."+$doc.display('jobPosting')) [[$jobPosting&gt;&gt;$joburl]] #end #end\\
    * **$doc.displayPrettyName('applyDate'):** $doc.display('applyDate')
    * **$doc.displayPrettyName('office'):** $doc.display('office')
    
    * **$doc.displayPrettyName('phone'):** $doc.display('phone')
    * **$doc.displayPrettyName('email'):** $doc.display('email')
    * **$doc.displayPrettyName('skype'):** $doc.display('skype')
    * **$doc.displayPrettyName('current_company'):** $doc.display('current_company')
    * **$doc.displayPrettyName('current_position'):** $doc.display('current_position')
    * **$doc.displayPrettyName('experience'):** $doc.display('experience')
    * **$doc.displayPrettyName('linkedin'):** $doc.display('linkedin')
    * **$doc.displayPrettyName('facebook'):** $doc.display('facebook')
    )))
    (%id='candidateApp'%)
    (((
    * **$doc.displayPrettyName('status'):** $doc.display('status')
    * **$doc.displayPrettyName('sourceType'):** $doc.display('sourceType')
    * **$doc.displayPrettyName('sourceChannel'):** $doc.display('sourceChannel')
    * **$doc.displayPrettyName('assignee'):** $doc.display('assignee')
    * **$doc.displayPrettyName('coverLetter'):** 
    #if($context.action == "edit")
        {{attachmentSelector classname="RecruitmentApp.RecruitmentAppClass" property="coverLetter" filter="pdf"/}}
    #else 
       #set($coverLetter = $doc.display('coverLetter'))
       #if("$!coverLetter" != "")

          {{pdfviewer height="300" file="$coverLetter"/}}
       #else 
          #info("No cover letter.")
       #end
    #end
    * **$doc.displayPrettyName('cv'):**
    #if($context.action == "edit")
        {{attachmentSelector classname="RecruitmentApp.RecruitmentAppClass" property="cv" filter="pdf"/}}
    #else 
       #set($cv = $doc.display('cv'))
       #if("$!cv" != "")

           {{pdfviewer height="300" file="$cv"/}}
       #else 
          #info("No cv.")
       #end
    #end
    * **$doc.displayPrettyName('next_step'):** $doc.display('next_step')
    * **$doc.displayPrettyName('hiringDate'):** $doc.display('hiringDate')
    * **$doc.displayPrettyName('details'):**
    $doc.display('details')
    )))

#if(!$doc.isNew())
    (%id='evaluations'%)
    (((
    &lt;br/&gt;&lt;br/&gt;
    #set($evals = $doc.getObjects("RecruitmentApp.EvaluationClass"))
    #if($evals.size() == 0)
       #info("This candidate has not been evaluated yet.")
    #else 
       #foreach($eval in $evals)
          #set($doHire = $eval.getProperty("hire").value)
          #if($doHire == 0 )
              #set($class = "")
              #set($hire = "-")
          #elseif ( $doHire == 1 )
              #set($hire = "yes")
              #set($class = "yes")
          #elseif ( $doHire == 2 )
              #set($hire = "no")
              #set($class = "no")
          #end
          &lt;div class="evaluation $class"&gt;
          #set($xWikiEvaluator = $eval.getProperty("evaluator").value)
          === Evaluation by $xwiki.getUserName($xWikiEvaluator, false) ===
          #if("$!hire" != "-") 
            &lt;div class="hiremention"&gt;
                &lt;span class="$hire"&gt;$hire&lt;/span&gt;
            &lt;/div&gt;
          #end
          * **Mark:** $eval.mark / 10
          * **Hire:** #if($context.action == "view") $hire #else $eval.hire #end\\
          * **Details:** $eval.details
          &lt;/div&gt;
       #end
    #end

    #set($request = $context.getRequest())
    #set($mark = $request.get("RecruitmentApp.EvaluationClass_${evals.size()}_mark"))
    #set($hire = $request.get("RecruitmentApp.EvaluationClass_${evals.size()}_hire"))
    #set($details = $request.get("RecruitmentApp.EvaluationClass_${evals.size()}_details"))
    #set($newEvaluation = $doc.newObject('RecruitmentApp.EvaluationClass'))

    #if("$!hire" != "" &amp;&amp; "$!details" != "" &amp;&amp; "$!mark" != "")
        $newEvaluation.set("mark", $mark)
        $newEvaluation.set("hire", $hire)
        $newEvaluation.set("details", $details)
        $newEvaluation.set("evaluator", $context.getUser())
        $doc.save()
        $response.sendRedirect($doc.getURL("view"))
    #end

    #if($isGuest) 
        #info("Please log in to add an evaluation.")
    #else
        #if($context.action == "view")
            &lt;div class="new-evaluation"&gt;
                 === Evaluation by $xwiki.getUserName($context.getUser(), false) ===
                &lt;form method="post" action=""&gt;
                    &lt;div class="row"&gt;**Mark:** $doc.display("mark", "edit", $newEvaluation) / 10 &lt;/div&gt;
                    &lt;div class="row"&gt;**Hire:** $doc.display("hire", "edit", $newEvaluation)&lt;/div&gt;
                    &lt;div class="row"&gt;**Details:** $doc.display("details", "edit", $newEvaluation)&lt;/div&gt;
                    &lt;div class="row"&gt;&lt;input type="submit" class="button" value="Save evaluation" /&gt;&lt;/div&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        #end
    #end
    )))
#end
{{/html}}{{/velocity}}</content>
</xwikidoc>
